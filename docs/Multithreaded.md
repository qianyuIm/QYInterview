# 多线程
NSThread	
- **[Runloop的概念与作用](#runloop的概念与作用)**	
GCD		
- **[GCD简介](#gcd简介)**	
NSOperation	  	
- **[PerformSelector的实现原理](#performSelector的实现原理)**  
- **[Runloop有五种开启方法](#runloop有五种开启方法)**  
- **[Runloop实际的应用](#runloop实际的应用)**	


## 1.NSThread
## 2.GCD
### GCD简介
Grand Central Dispatch(GCD)是Apple开发的一个多核编程的较新的解决方法。它主要用于优化应用程序以支持多核处理器的系统。它是一个在线程池模式的基础上执行的并行任务。在Mac OS X 10.6雪豹中首次推出，对应iOS版本为iOS4.0。
### 我们为什么要使用GCD呢？
* GCD 可用于多核的并行运算
* GCD 会自动利用更多的CPU内核(比如双核，四核)
* GCD 会自动管理线程的生命周期(创建任务，调度任务，销毁线程)
* 程序员只需要告诉GCD 想要执行什么任务，不需要编写任何线程管理代码	

### GCD 任务和队列
GCD 两个核心概念: **『任务』** 和 **『队列』**。	
**任务**: 就是执行操作的意思，换句话说就是你在线程中执行的那段代码。在GCD 中是放在block中的。执行任务有两种方式:**『同步执行』** 和 **『异步执行』**。两者的主要区别是: **是否等待队列中的任务执行结束，以及是否具备开启新线程的能力**。  

* **同步执行(sync)**		
	* 同步添加任务到指定的队列中，在添加的任务执行结束之前，会一直等待，直到队列中的任务完成之后再继续执行
	* 只能在当前线程中执行任务，不具备开启新线程的能力  
* **异步执行(async)**  
	* 异步添加任务到指定的队列中，它不会做任何等待，可以继续执行任务。
	* 可以在新线程中执行任务，具备开启新线程的能力。
   
> **注意：异步执行(async) 虽然具备开启新线程的能力，但不一定开启新线程。这跟任务所指定的队列类型有关**  

**队列(Dispatch Queue)**: 这里的队列指执行任务的队列，即用来存放任务的队列。队列是一种特殊的线性表，采用FIFO(先进先出)的原则，即新任务总是呗插入到队列的末尾，而读取任务的时候总是从队列的头部开始读取。每读取一个任务，则从队列中释放一个任务。在GCD 中有两种队列 **『串行队列』** 和 **『并发队列』**。两者都符合FIFO的原则。两者的主要区别是: **执行顺序不同，以及开启线程数不同。**  

* **串行队列(Serial Dispatch Queue):**  
	* 每次只有一个任务被执行。让任务一个接一个的执行。(只开启一个线程，一个任务执行完毕，再执行下一个任务)
* **并发队列(Concurrent Dispatch Queue):**
	* 可以让多个任务并发(同时)执行。(可以开启多个线程,并同时执行任务)
	
> 注意: **并发队列** 的并发功能只有在异步方法下才有效

### GCD 的其他方法:
1. **GCD 栅栏方法:(```dispatch_barrier_async```)** 

![dispatch_barrier_async](images/dispatch_barrier_async.webp)  
2. 



## 3. NSOperation
1. NSOperation 自定义	

* 重写的方法

```swift
// 对于并发的Operation需要重写改方法 SDWebImage
- (void)start;

// 非并发的Operation需要重写该方法 Toaster 吐司，注意不需要使用@autoreleasepool
- (void)main;
```
